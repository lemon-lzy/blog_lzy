---
title: 平台化改造
published: 2026-01-11
description: ''
image: './cover.png'
tags: ["项目"]
category: '项目'
draft: false 
lang: ''
---

# 一、需求分析
之前我们实现‍的是单机版本，用户只能在本地生成代码文件。现在我们要将其升级为平台化系统؜，这意味着需要支持多用户、应用管理、在线部署等功能。

**需要的具体功能包括**：
- 用户基础功能

- 创建应用

- 编辑应用信息

- 删除自己的应用

- 查看应用详情

- 分页查询自己的应用列表

- 分页查看精选应用列表

- 用户高级功能

- - ⭐️ 实时查看应用效果

- - ⭐️ 应用部署

- 管理功能

- 管理所有应用（删除、查询、修改）

- 设置精选应用
# 二、方案设计
## 核心业务流程
平台化改造的核心在于 建立完整的应用生命周期管理体系。

用户在主页输入提‍示词后，系统会创建一个应用记录，然后跳转到对话页面与 AI 交互生成网站。生成完成后，用户؜可以预览效果，满意后进行部署，让网站真正对外提供服务。

## 库表设计
应用表是整‍个项目的核心，需要记录**应用的基本信息、生成配置、部署؜信息**等。

其中最关键的是 deployKey 字段。由于每个网站应用文件的部署都是隔离的（想象成沙箱），需要用唯一字段来区分，可以作为应用的存储和访问路径；而且为了便于访问，每个应用的访问路径不能太长。

app 表的建表 SQL 如下：
````
-- 应用表
create table app
(
    id           bigint auto_increment comment 'id' primary key,
    appName      varchar(256)                       null comment '应用名称',
    cover        varchar(512)                       null comment '应用封面',
    initPrompt   text                               null comment '应用初始化的 prompt',
    codeGenType  varchar(64)                        null comment '代码生成类型（枚举）',
    deployKey    varchar(64)                        null comment '部署标识',
    deployedTime datetime                           null comment '部署时间',
    priority     int      default 0                 not null comment '优先级',
    userId       bigint                             not null comment '创建用户id',
    editTime     datetime default CURRENT_TIMESTAMP not null comment '编辑时间',
    createTime   datetime default CURRENT_TIMESTAMP not null comment '创建时间',
    updateTime   datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '更新时间',
    isDelete     tinyint  default 0                 not null comment '是否删除',
    UNIQUE KEY uk_deployKey (deployKey), -- 确保部署标识唯一
    INDEX idx_appName (appName),         -- 提升基于应用名称的查询性能
    INDEX idx_userId (userId)            -- 提升基于用户 ID 的查询性能
) comment '应用' collate = utf8mb4_unicode_ci;
````
**设计细节**：

1）priority 优先级字段：我们约定 99 表示精选应用，这样可以在主页展示高质量的应用，避免用户看到大量测试内容。

为什么用数字‍而不用枚举类型呢？原因是这样更利于扩展，比如约定 999 表示置顶؜；还可以根据数字灵活调整各个应用的具体展示顺序。

2）添加索引‍：给 deployKey、appName、userId 三个经常用؜于作为查询条件的字段增加索引，提高查询性能。

注意，我们暂时‍不考虑将应用代码直接保存到数据库字段中，而是保存在文件系统里。这样可以避免数据库和文؜件存储不一致的问题，也便于后续扩展到对象存储等方案。

# 三、基础应用能力（后端）
后端开发最‍终的目标是提供接口，我们先来实现一些基础的接口，也就是؜ “增删改查”:

- 【用户】创建应用（须填写 initPrompt）
- 【用户】根据 id 修改自己的应用（目前只支持修改应用名称）
- 【用户】根据 id 删除自己的应用
- 【用户】根据 id 查看应用详情
- 【用户】分页查询自己的应用列表（支持根据名称查询，每页最多 20 个）
- 【用户】分页查询精选的应用列表（支持根据名称查询，每页最多 20 个）
- 【管理员】根据 id 删除任意应用
- 【管理员】根据 id 更新任意应用（支持更新应用名称、应用封面、优先级）
- 【管理员】分页查询应用列表（支持根据除时间外的任何字段查询，每页数量不限）
- 【管理员】根据 id 查看应用详情

## 核心功能实现：
### 创建应用
用户创建应‍用时，只需要填写初始化提示词。系统会自动生成应用名称（؜取提示词前 12 位）和默认的代码生成类型。
### 更新应用
用户更新应用时，需要进行权限校验，确保只能修改自己的应用。
### 用户删除应用
需要进行权限校验，确保只能修改自己的应用。
### 用户查看应用详情
应用查询涉‍及到关联查询用户信息，需要创建 App 的封装类，包含؜ UserVO 用户信息字段：
### 用户分页查询应用
查询请求类，主要定义了可作为查询条件的字段：
#### 注意
分页查询应用‍时，也需要额外获取创建应用的用户信息，这会涉及到关联查询多个用户信؜息，我们需要优化查询性能。优化查询逻辑如下：

- 先收集所有 userId 到集合中
- 根据 userId 集合批量查询所有用户信息
- 构建 Map 映射关系 userId => UserVO
- 一次性组装所有 AppVO，根据 userId 从 Map 中取到需要的用户信息
### 用户分页查询精选应用
用户只能在主页查询精选应用列表（还有自己的），这样主页会更干净؜；同时避免了爬虫，相当于起到了一个管理员审核的作用。
### 管理员删除应用
跟用户删除‍应用接口类似，但是管理员可以删除任意应用，可以通过权限؜注解校验权限
### 管理员更新应用
管理员可以更新‍任意应用的应用名称、应用封面和优先级，更新优先级的操作其实就是精选。
### 管理员分页查询应用
管理员比普‍通用户拥有更大的查询范围，支持根据除时间外的任何字段查؜询，并且每页数量不限。
### 管理员查看应用详情
这个接口除了权限之外，目前跟用户查看应用详情接口没有区别