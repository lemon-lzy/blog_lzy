---
title: 项目部署
published: 2024-11-10
description: ''
image: '../cover.png'
tags: ["idea"]
category: 'idea'
draft: false 
lang: ''
---
# 项目的部署


傻了傻了，我竟然把spring.profiles.active写成serve.profiles.active了。不过好奇怪，我看鱼皮就是这么写的嘞。简单说一下这次的收获把。
首先，要购买一台属于自己的服务器，然后用重置服务器的密码。在Xshell中连接服务器，百度搜对应指令下载宝塔面板，然后复制宝塔的url,进行访问（注意要开服务器的8888端口）。下载对应的依赖（Tomcat加nginx加mysql加php）。我采用的是前端在pre加上域名➕端口（没有申请域名就用服务器ip地址加端口，前端端口不用写，用默认80就行，后端如果没有域名就不用填了），然后后端配置跨域进行联通的。(端口的话前端用默认的80端口，后端端口一点要和后端项目配置的端口相同)

下面是后端跨域的过滤器配置:

package com.cxstar.dao.data.config;

import org.springframework.stereotype.Component;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**

* 单机测试时如果有跨域问题，就用这个Filter解决，把@Component前的注释移除即可
* 如果是在微服务中，跨域问题在网关层进行了解决，服务没必要再次进行处理，把@Component注释掉即可
  */

@Component
public class CORSFilter implements Filter {


    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        HttpServletResponse res = (HttpServletResponse) response;
        HttpServletRequest req = (HttpServletRequest) request;
        res.addHeader("Access-Control-Allow-Credentials", "true");
        res.addHeader("Access-Control-Allow-Origin", req.getHeader("origin"));
        res.addHeader("Access-Control-Allow-Methods", "GET, POST, DELETE, PUT");
        res.addHeader("Access-Control-Allow-Headers", "Content-Type,X-CAF-Authorization-Token,sessionToken,X-TOKEN,customercoderoute,authorization,conntectionid,Cookie");
        if (((HttpServletRequest) request).getMethod().equals("OPTIONS")) {
            response.getWriter().println("ok");
            return;
        }
        chain.doFilter(request, response);
    }
    
    @Override
    public void destroy() {
    }
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
    }

}package com.cxstar.dao.data.config;

import org.springframework.stereotype.Component;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**

* 单机测试时如果有跨域问题，就用这个Filter解决，把@Component前的注释移除即可
* 如果是在微服务中，跨域问题在网关层进行了解决，服务没必要再次进行处理，把@Component注释掉即可
  */

@Component
public class CORSFilter implements Filter {


    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        HttpServletResponse res = (HttpServletResponse) response;
        HttpServletRequest req = (HttpServletRequest) request;
        res.addHeader("Access-Control-Allow-Credentials", "true");
        res.addHeader("Access-Control-Allow-Origin", req.getHeader("origin"));
        res.addHeader("Access-Control-Allow-Methods", "GET, POST, DELETE, PUT");
        res.addHeader("Access-Control-Allow-Headers", "Content-Type,X-CAF-Authorization-Token,sessionToken,X-TOKEN,customercoderoute,authorization,conntectionid,Cookie");
        if (((HttpServletRequest) request).getMethod().equals("OPTIONS")) {
            response.getWriter().println("ok");
            return;
        }
        chain.doFilter(request, response);
    }
    
    @Override
    public void destroy() {
    }
    
    @Override
    public void init(FilterConfig filterConfig) throws ServletException {
    }

}

    这里讲一下我的收获，在部署上线的收获数据库与redis是否能连上是额外重要的，所以我们在上线之前，一定要在本地用生产环境运行一下jar包 保证我们数据库的链接和redis的链接是OK的。
    mysql的创建在宝塔面板的数据库点击添加数据库，输入信息后即可创建成功，我们可以在idea或者navicat中将我们保存的表信息（sql创建表语句）导入到里面 ，创建项目需要的表。redis的话要下载一个redis,这里redis我好像连不上，是因为权限还是啥的，会报一个长长的错误，不能实例化一堆东西，本质上就是redis链接失败。所以测试是否链接成功很重要（还有看ylm文件用鼠标移动到那些字段看看是不是生效的，可能间距错了，这里要注意本地的redis的yml不用传password，线上的redis要传password,不然会报错，注意线上的redis是否已经启动）
     线上数据库和redis测试完毕后，我们要做的将前端打成dist包，然后创建一个站点，将打完的包放置在该站点的目录中。（注意站点设置里面的目录的/要换成/dist）,不然会403。最后我们访问前端项目，显示出页面前端就OK了。
    后端的话测试完线上数据库,redis啥的后，打包然后上传到宝塔的文件中，然后在终端中先运行项目 java -jar  .........--spring.profiles.active=prod查看运行是否正常，如果不正常，还有日志可以看如果可以，挂着终端运行，在前端发送请求，查看是否能联调，如果不能联调，查看终端的日志进行改变（一般本地能跑，路径配置也OK的话，大概率是那个ylm里面数据库或者redis哪里搞错或者连不上了），一切都OK后 就可以添加java项目长久运行该java包了。（注意要写--spring.profiles.active=prod）

注意:使用的数据库，redis，项目端口以及80，443端口都要在防火墙和服务器安全组添加。

最后上线伙伴匹配系统的时候出现了前段一闪而过然后404，这里要在nginx的配置文件中加入以下内容
`location / {`
`root /www/wwwroot/47.113.192.156/dist;`
`index  index.html index.htm;`
`try_files  $uri $uri/ @router;`
`}`

`location @router {`
`rewrite ^.*$ /index.html last;`
`}`
其中root /www/wwwroot/47.113.192.156/dist为前端项目的文件目录